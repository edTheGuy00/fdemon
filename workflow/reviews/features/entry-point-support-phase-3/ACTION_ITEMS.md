# Action Items: Entry Point Support Phase 3

**Review Date:** 2026-01-25
**Verdict:** ⚠️ APPROVED WITH CONCERNS
**Blocking Issues:** 0 (Major issue is tracked but not blocking)

---

## Major Issues (Should Fix Soon)

### 1. Move Entry Point Discovery to Async Task

- **Source:** Risks & Tradeoffs Analyzer
- **File:** `src/app/handler/new_session/fuzzy_modal.rs:40-42`
- **Line:** 40-42
- **Problem:** Synchronous filesystem I/O in update handler blocks UI thread and violates TEA pattern
- **Required Action:**
  1. Create `UpdateAction::DiscoverEntryPoints` variant
  2. Move `discover_entry_points()` to async task spawned by action runner
  3. Return results via `Message::EntryPointsDiscovered`
  4. Open modal only after discovery completes
- **Acceptance:**
  - Discovery runs in background
  - UI remains responsive during discovery
  - Large projects (500+ files) don't freeze UI

---

## Minor Issues (Consider Fixing)

### 1. Reorder Editability Check

- **Source:** Logic Reasoning Checker
- **File:** `src/app/handler/new_session/launch_context.rs`
- **Line:** 319-334
- **Problem:** Selection is parsed before checking if field is editable
- **Suggested Action:** Move `is_entry_point_editable()` check before parsing selection
- **Note:** Not a bug, just pattern inconsistency with flavor handler

### 2. Add File Size Guard in Discovery

- **Source:** Risks & Tradeoffs Analyzer
- **File:** `src/core/discovery.rs`
- **Line:** 434
- **Problem:** No file size limit when reading Dart files for main() check
- **Suggested Action:** Skip files > 1MB in `has_main_function()`
- **Note:** Prevents memory issues with large generated files

### 3. Add Loading Indicator During Discovery

- **Source:** Risks & Tradeoffs Analyzer
- **Problem:** No user feedback during entry point discovery
- **Suggested Action:** Show spinner or "Discovering..." text in modal
- **Note:** Important if async discovery is implemented

---

## Nice to Have (Future Improvements)

### 1. Cache Entry Points with Invalidation

- **Problem:** Discovery runs on every modal open
- **Suggestion:** Cache results, invalidate when file watcher detects lib/ changes
- **Priority:** Low - current behavior is correct, just slow

### 2. Parallel File Discovery

- **Problem:** Files scanned sequentially
- **Suggestion:** Use rayon for concurrent file reading
- **Priority:** Low - only matters for very large projects

### 3. Streaming Regex Search

- **Problem:** Entire file read into memory for regex search
- **Suggestion:** Use streaming reader with line-by-line search
- **Priority:** Low - file size guard is simpler solution

---

## Re-review Checklist

After addressing issues, the following must pass:

- [ ] All tests pass: `cargo test --lib`
- [ ] No clippy warnings: `cargo clippy -- -D warnings`
- [ ] Code formatted: `cargo fmt -- --check`
- [ ] Entry point modal opens without UI freeze on large projects
- [ ] Async discovery completes and updates modal correctly
- [ ] All existing Phase 3 acceptance criteria still met

---

## Tracking

| Issue | Priority | Effort | Status |
|-------|----------|--------|--------|
| Async discovery | High | Medium | TODO |
| File size guard | Medium | Low | TODO |
| Loading indicator | Medium | Low | TODO |
| Editability check order | Low | Low | Optional |
| Caching | Low | Medium | Backlog |

---

*Generated by Claude Code Reviewer Skill*
